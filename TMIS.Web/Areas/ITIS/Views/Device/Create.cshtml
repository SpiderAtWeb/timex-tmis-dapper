@using TMIS.Models.ITIS.VM
@model CreateDeviceVM

@section VendorStyles {
    <link rel="stylesheet" href="~/vendor/libs/flatpickr/flatpickr.css" />
    <link rel="stylesheet" href="~/vendor/libs/select2/select2.css" />
    <link href="~/css/input-text-upper.css" rel="stylesheet" />
}

@section VendorScripts {
    <script src="~/vendor/libs/flatpickr/flatpickr.js"></script>
    <script src="~/vendor/libs/select2/select2.js"></script>
}

@section PageScripts {
    <script src="~/js/form-layouts.js"></script>
    <script src="~/custom/input-text-upper.js"></script>
<script>

			$('.select2').select2({
		  placeholder: "- Select -",
		  allowClear: true
		});

	let attributeindex = 0;
		$('#Device_DeviceTypeID').on('change', function () {
			
		$('#attributeContainer').empty();
		const deviceTypeId = $(this).val();		

		if (!deviceTypeId) return;
		
		$.get(`/ITIS/Device/GetAttributesByDeviceType?deviceTypeId=${deviceTypeId}`, function (data) {
			let allHtml =  '<div class="row g-2">'; // Wrap with Bootstrap row;
			data.attributes.forEach(attr => {
				let html = `<div class="col-md-3">
							  <div class="form-floating form-floating-outline">`;

				if (attr.dataType === 1 && attr.options) {
					html += `<input type="hidden" name="Attributes[${attributeindex}].AttributeID" value="${attr.attributeID}" />`;
					html += `<select name="Attributes[${attributeindex}].Value" class="form-select select2" data-allow-clear="true">`;
					html += `<option value="" selected>- Select -</option>`;
					attr.options.forEach(opt => {
					  html += `<option value="${opt}">${opt}</option>`;
					});
					html += `</select>`;
				}
				else if (attr.dataType === 2) {
					html += `<input type="hidden" name="Attributes[${attributeindex}].AttributeID" value="${attr.attributeID}" />`;
					html += `<input type="text" name="Attributes[${attributeindex}].Value" class="form-control" />`;
				}
				else if (attr.dataType === 3){
					html += `<input type="hidden" name="Attributes[${attributeindex}].AttributeID" value="${attr.attributeID}" />`;
					html += `<input type="number" name="Attributes[${attributeindex}].Value" class="form-control" />`;
				}
				else{
					html += `<input type="hidden" name="Attributes[${attributeindex}].AttributeID" value="${attr.attributeID}" />`;
					html += `<input type="date" name="Attributes[${attributeindex}].Value" class="form-control" />`;
				}

				html += `<label>${attr.name}</label>
							</div>
								</div>`;
				allHtml += html; // Add to the main HTML variable
				attributeindex++;
			});

			allHtml += '</div>'; // Close the row			
			$('#attributeContainer').html(allHtml);
			
		});
	});
</script>
}

<!-- Multi Column with Form Separator -->
<div class="card mb-6">
	<h5 class="card-header page-header">
		New Device
	</h5>
	<form asp-action="Create" method="post" class="card-body" id="myForm" enctype="multipart/form-data">

		<div class="row g-2">

			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<select asp-for="@Model.Device!.Location" asp-items="@Model.LocationList" class="select2 form-select" data-allow-clear="true">
						<option value="" Disabled Selected>- Select Location -</option>
					</select>

					<label asp-for="Device!.Location"></label>
					<span asp-validation-for="@Model.Device!.Location" class="text-warning"></span>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<input asp-for="@Model.Device!.DeviceName" type="text" id="style-no" class="form-control" placeholder="CHO0001" />
					<label asp-for="@Model.Device!.DeviceName"></label>
					<span asp-validation-for="@Model.Device!.DeviceName" class="customerError text-warning"></span>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<input asp-for="@Model.Device!.SerialNumber" type="text" id="style-no" class="form-control" placeholder="5CG2490NLG" />
					<label asp-for="@Model.Device!.SerialNumber"></label>
					<span asp-validation-for="@Model.Device!.SerialNumber" class="customerError text-warning"></span>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<input asp-for="@Model.Device!.FixedAssetCode" type="text" id="style-no" class="form-control" placeholder="FAC001245" />
					<label asp-for="@Model.Device!.FixedAssetCode"></label>
					<span asp-validation-for="@Model.Device!.FixedAssetCode" class="customerError text-warning"></span>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<input asp-for="@Model.Device!.PurchasedDate" type="date" id="datePurchased" class="form-control dob-picker" placeholder="YYYY-MM-DD" />
					<label asp-for="@Model.Device!.PurchasedDate"></label>
					<span asp-validation-for="@Model.Device!.PurchasedDate" class="text-warning"></span>
				</div>
			</div>
			<div class="col-3">
				<div class="form-floating form-floating-outline">
					<input class="form-control" type="file" name="image1">
					<label asp-for="Device.Image1Data" class="form-label"></label>
					<span asp-validation-for="Device.Image1Data" class="text-warning"></span>
				</div>
			</div>
			<div class="col-3">
				<div class="form-floating form-floating-outline">
					<input class="form-control" type="file" name="image2">
					<label asp-for="Device.Image2Data" class="form-label"></label>
				</div>				
			</div>
			<div class="col-3">
				<div class="form-floating form-floating-outline">
					<input class="form-control" type="file" name="image3">
					<label asp-for="Device.Image3Data" class="form-label"></label>
				</div>
			</div>
			<div class="col-3">
				<div class="form-floating form-floating-outline">				
					<input class="form-control" type="file" name="image4">
					<label asp-for="Device.Image4Data" class="form-label"></label>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<select asp-for="@Model.Device!.VendorID" asp-items="@Model.VendorsList" class="select2 form-select" data-allow-clear="true">
						<option value=""  Disabled Selected>- Select Vendor -</option>
					</select>

					<label asp-for="Device!.VendorID"></label>
					<span asp-validation-for="@Model.Device!.VendorID" class="text-warning"></span>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<select asp-for="@Model.Device!.DeviceStatusID" asp-items="@Model.DeviceStatusList" class="select2 form-select" data-allow-clear="true">
						<option value="" Disabled Selected>- Select Status -</option>
					</select>

					<label asp-for="Device!.DeviceStatusID"></label>
					<span asp-validation-for="@Model.Device!.DeviceStatusID" class="text-warning"></span>
				</div>
			</div>
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<input asp-for="@Model.Device!.Depreciation" type="number" id="style-no" class="form-control" placeholder="Depreciation in months" min="0" />
					<label asp-for="@Model.Device!.Depreciation"></label>
					<span asp-validation-for="@Model.Device!.Depreciation" class="customerError text-warning"></span>
				</div>
			</div>			
			<div class="col-md-2">				
				<div class="list-group">
					<label class="list-group-item w-100">
						<span class="form-check mb-0">
							<input asp-for="@Model.Device!.IsRented" class="form-check-input me-4" type="checkbox">
							Is Rented
						</span>
					</label>						
				</div>								
			</div>
			<div class="col-md-2">
				<div class="list-group">
					<label class="list-group-item w-100">
						<span class="form-check mb-0">
							<input asp-for="@Model.Device!.IsBrandNew" class="form-check-input me-4" type="checkbox">
							Is Brand New
						</span>
					</label>
				</div>
			</div>		
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<input asp-for="@Model.Device!.Remark" type="text" id="style-no" class="form-control"/>
					<label asp-for="@Model.Device!.Remark"></label>
					<span asp-validation-for="@Model.Device!.Remark" class="customerError text-warning"></span>
				</div>
			</div>			
			<div class="col-md-3">
				<div class="form-floating form-floating-outline">
					<select asp-for="@Model.Device!.DeviceTypeID" asp-items="@Model.DeviceTypeList" class="select2 form-select" data-allow-clear="true">
						<option value="" Disabled Selected>- Select Device Type -</option>
					</select>

					<label asp-for="Device!.DeviceTypeID"></label>
					<span asp-validation-for="@Model.Device!.DeviceTypeID" class="text-warning"></span>
				</div>
			</div>
			<div class="card" id="additionalField" >
				<div class="card-header fw-bold">
					Additional Fields
				</div>
				<div class="card-body">
					<div class="row g-2" id="attributeContainer">
						<!-- Dynamic content will go here -->
					</div>
				</div>
			</div>
			<div class="pt-1">
				<button type="submit" class="btn btn-primary me-1">Submit</button>
				<button type="reset" class="btn btn-primary me-1">Clear</button>
				<a asp-controller="Device" asp-action="Index" class="btn btn-outline-secondary">Back to List</a>
			</div>

		</div>
	</form>

</div>

